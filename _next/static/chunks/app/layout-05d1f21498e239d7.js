(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{5481:function(e,t,r){Promise.resolve().then(r.bind(r,5833))},2914:function(e,t,r){"use strict";r.d(t,{V:function(){return getContenttype},l:function(){return errorCatch}});let getContenttype=()=>({"Content-type":"application/json"}),errorCatch=e=>{var t,r;let n=null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message;return n?"object"==typeof e.response.data.message?n[0]:n:e.message}},5957:function(e,t,r){"use strict";r.d(t,{v:function(){return u}});var n=r(9222),a=r(2914),s=r(5583),o=r(9497);let i={baseURL:"http://89.111.152.225:3500/api",headers:(0,a.V)()},u=n.Z.create(i),l=n.Z.create(i);l.interceptors.request.use(async e=>{let t=(0,s.Hk)();return e.headers&&t&&(e.headers.Authorization="Bearer ".concat(t)),e}),l.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if(((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401||"jwt expired"===(0,a.l)(e)||"jwt must be provided"===(0,a.l)(e))&&e.config&&!e.config._isRetry){r._isRetry=!0;try{return await o.e.getNewTokens(),l.request(r)}catch(e){"jwt expired"===(0,a.l)(e)&&(0,s.Pf)()}}}),t.Z=l},5833:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return RootLayout}});var n=r(7437),a=r(2084),s=r.n(a),o=r(7373),i=r(663),u=r(9081),l=r(8682),c=r(7265);let d={user:(e=>{if("undefined"!=typeof localStorage){let t=localStorage.getItem(e);return t?JSON.parse(t):null}})("user"),isLoading:!1,message:"",errPassword:"",editmes:""},g=(0,i.oM)({name:"User",initialState:d,reducers:{},extraReducers:e=>{e.addCase(c.register.pending,e=>{e.isLoading=!0,e.message=""}).addCase(c.register.fulfilled,(e,t)=>{let{payload:r}=t;e.isLoading=!1,e.user=r.user,e.message=""}).addCase(c.register.rejected,e=>{e.isLoading=!1,e.message="User с таким email или именем уже есть"}).addCase(c.login.pending,e=>{console.log("Идет загрузка"),e.isLoading=!0,e.errPassword=""}).addCase(c.login.fulfilled,(e,t)=>{let{payload:r}=t;console.log("Успешный вход"),e.isLoading=!1,e.user=r.user,e.errPassword=""}).addCase(c.login.rejected,e=>{console.log("Произошла внеплановая ошибка"),e.isLoading=!1,e.user=null,e.errPassword="Неверный пароль или почта"}).addCase(c.logout.fulfilled,e=>{e.isLoading=!1,e.user=null}).addCase(c.checkAuth.fulfilled,(e,t)=>{let{payload:r}=t;e.user=r.user})}});var f=g.reducer,h=r(6549),m=r(5456);let v=(0,m.Z)("local"),p=(0,i.oM)({name:"Catalog",initialState:{count:2},reducers:{setCategory(e,t){let{payload:r}=t;e.count=r}}}),{setCategory:y}=p.actions,C=(0,i.oM)({name:"Script",initialState:{script:"Golos_Text"},reducers:{setScript(e,t){let{payload:r}=t;e.script=r}}});var k=C.reducer;let{setScript:T}=C.actions;var w=r(191);let S=(0,i.oM)({name:"order",initialState:{orders:0},reducers:{addNewOrder(e){e.orders+=1}}});var b=S.reducer;let{addNewOrder:x}=S.actions,j=(0,o.UY)({user:f,cart:h.default,category:p.reducer,script:k,theme:w.Z,order:b}),Z=(0,u.OJ)({key:"OLI Rewards",storage:v,whitelist:["cart"],version:1},j),O=(0,i.xC)({reducer:Z,middleware:e=>e({serializableCheck:{ignoredActions:[u._P,u.E7,u.ex,u.e,u.Nz,u.I2]}})}),L=(0,l.Z)(O);r(8877);var P=r(3198),N=r(3837),_=r(5171),A=r(165),I=r(2265),V=r(415),U=r.n(V),q=r(2625),E=r(9127),M=r(4033),R=r(5583),J=r(1490);let z=U()(()=>r.e(275).then(r.bind(r,5275)),{loadableGenerated:{webpack:()=>[5275]},ssr:!1});var auth_provider=e=>{let{Component:{isOnlyUser:t},children:r}=e,{user:a}=(0,q.J)(),{checkAuth:s,logout:o}=(0,E.o)(),i=(0,M.usePathname)();return(0,I.useEffect)(()=>{let e=(0,R.Hk)();e&&s()},[]),(0,I.useEffect)(()=>{let e=J.Z.get("refreshToken");e||o()},[i]),t?(0,n.jsx)(z,{Component:{isOnlyUser:t},children:"children"}):(0,n.jsx)(n.Fragment,{children:r})};let F=new _.S({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});function RootLayout(e){var t;let{children:r,Component:a}=e;return(0,n.jsx)("html",{lang:"en",children:(0,n.jsx)("body",{className:s().className,children:(0,n.jsx)(A.aH,{client:F,children:(0,n.jsx)(P.zt,{store:O,children:(0,n.jsx)(N.r,{persistor:L,children:(0,n.jsx)(auth_provider,{Component:{isOnlyUser:null==a?void 0:null===(t=a.Component)||void 0===t?void 0:t.isOnlyUser},children:r})})})})})})}},9127:function(e,t,r){"use strict";r.d(t,{o:function(){return useActions}});var n=r(2265),a=r(690),s=r(7373),o=r(7265),i=r(6549);let u={...o,...i},useActions=()=>{let e=(0,a.T)();return(0,n.useMemo)(()=>(0,s.DE)(u,e),[e])}},2625:function(e,t,r){"use strict";r.d(t,{J:function(){return UseAuth}});var n=r(690);let UseAuth=()=>(0,n.C)(e=>e.user)},690:function(e,t,r){"use strict";r.d(t,{C:function(){return s},T:function(){return a}});var n=r(3198);let a=n.I0,s=n.v9},5583:function(e,t,r){"use strict";r.d(t,{Hk:function(){return getAccesToken},Pf:function(){return removeTokensStorage},Zd:function(){return saveToStoraga}});var n=r(1490);let saveTokenStorage=e=>{n.Z.set("accesToken",e.accesToken),n.Z.set("refreshToken",e.refreshToken)},getAccesToken=()=>{let e=n.Z.get("accesToken");return e||null},removeTokensStorage=()=>{n.Z.remove("accesToken"),n.Z.remove("refreshToken"),localStorage.removeItem("user")},saveToStoraga=e=>{saveTokenStorage(e),localStorage.setItem("user",JSON.stringify(e.user))}},9497:function(e,t,r){"use strict";r.d(t,{e:function(){return o}});var n=r(5957),a=r(5583),s=r(1490);let o={async login(e){let t=await (0,n.v)({url:"/auth/login",method:"POST",data:e});return t.data&&((0,a.Zd)(t.data),localStorage.setItem("count","2")),t.data},async register(e){let t=await (0,n.v)({url:"/auth/register",method:"POST",data:e});return t.data&&((0,a.Zd)(t.data),localStorage.setItem("count","2")),t},async getNewTokens(){let e=s.Z.get("refreshToken"),t=await (0,n.v)({url:"/auth/tokens",method:"POST",data:{refreshToken:e}});return t.data.accesToken&&(0,a.Zd)(t.data),t}}},6549:function(e,t,r){"use strict";r.r(t),r.d(t,{addToCart:function(){return s},changeQuantity:function(){return i},removeFromCart:function(){return o},resetCart:function(){return u},setComVis:function(){return c},setVisible:function(){return l}});var n=r(663);let a=(0,n.oM)({name:"cart",initialState:{items:[],visible:!1,comVis:!1},reducers:{addToCart(e,t){e.items.some(e=>{var r,n;return(null===(r=e.product)||void 0===r?void 0:r.id)===(null===(n=t.payload.product)||void 0===n?void 0:n.id)});let r=e.items.some(e=>e.text===t.payload.text);r||e.items.push({...t.payload,id:e.items.length})},removeFromCart(e,t){e.items=e.items.filter(e=>e.text!==t.payload.text)},changeQuantity(e,t){let{slug:r,type:n,text:a}=t.payload,s=e.items.find(e=>e.text===a);s&&("plus"===n?s.quantity&&s.quantity++:s.quantity&&s.quantity--)},resetCart(e){e.items=[]},setVisible(e,t){t.payload.visible?e.visible=!1:e.visible=!0},setComVis(e,t){t.payload.visible?e.visible=!1:e.visible=!0}}});t.default=a.reducer;let{addToCart:s,removeFromCart:o,changeQuantity:i,resetCart:u,setVisible:l,setComVis:c}=a.actions},191:function(e,t,r){"use strict";r.d(t,{L:function(){return s}});var n=r(663);let a=(0,n.oM)({name:"theme",initialState:{theme:"white"},reducers:{changeTheme(e,t){e.theme=t.payload.theme}}});t.Z=a.reducer;let{changeTheme:s}=a.actions},7265:function(e,t,r){"use strict";r.r(t),r.d(t,{checkAuth:function(){return d},login:function(){return l},logout:function(){return c},register:function(){return u}});var n=r(663),a=r(9497),s=r(5583),o=r(2914),i=r(6549);let u=(0,n.hg)("auth/register",async(e,t)=>{try{let t=await a.e.register(e);return localStorage.setItem("count","2"),t.data}catch(e){return t.rejectWithValue(e)}}),l=(0,n.hg)("auth/login",async(e,t)=>{try{let t=await a.e.login(e);return localStorage.setItem("count","2"),t}catch(e){return t.rejectWithValue(e)}}),c=(0,n.hg)("auth/logout",async()=>{(0,s.Pf)(),(0,i.resetCart)()}),d=(0,n.hg)("auth/check-auth",async(e,t)=>{try{let e=await a.e.getNewTokens();return e.data}catch(e){return"jwt expired"===(0,o.l)(e)&&t.dispatch(c),t.rejectWithValue(e)}})},8877:function(){}},function(e){e.O(0,[83,529,440,971,864,744],function(){return e(e.s=5481)}),_N_E=e.O()}]);